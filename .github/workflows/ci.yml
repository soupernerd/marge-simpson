name: Marge Simpson CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  test-windows:
    name: Test on Windows
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Run Marge Self-Tests (PowerShell)
        shell: pwsh
        run: |
          powershell -ExecutionPolicy Bypass -File ./marge_simpson/scripts/test-marge.ps1

  test-linux:
    name: Test on Linux
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Make scripts executable
        run: |
          chmod +x ./marge_simpson/scripts/verify.sh
          chmod +x ./marge_simpson/scripts/cleanup.sh
          chmod +x ./marge_simpson/scripts/test-marge.sh
      
      - name: Run Marge Self-Tests (Bash)
        run: ./marge_simpson/scripts/test-marge.sh

  test-macos:
    name: Test on macOS
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Make scripts executable
        run: |
          chmod +x ./marge_simpson/scripts/verify.sh
          chmod +x ./marge_simpson/scripts/cleanup.sh
          chmod +x ./marge_simpson/scripts/test-marge.sh
      
      - name: Run Marge Self-Tests (Bash)
        run: ./marge_simpson/scripts/test-marge.sh

  shellcheck:
    name: ShellCheck Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install ShellCheck
        run: sudo apt-get install -y shellcheck
      
      - name: Run ShellCheck on shell scripts
        run: |
          shellcheck ./marge_simpson/scripts/verify.sh || true
          shellcheck ./marge_simpson/scripts/cleanup.sh || true
          shellcheck ./marge_simpson/scripts/test-marge.sh || true
          shellcheck ./install.sh || true
          shellcheck ./convert-to-meta.sh || true
